<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Slider Puzzle</title>
    <link rel="stylesheet" href="https://csingendonk.github.io/htmlpanels/sliderPuzzle/css/style.css">
</head>

<body>
    <header id="header" class="header-main bar" role="banner">
        <span class="header-main-title">
            <h1>Slider Puzzle</h1>
        </span>
        <span class="header-main-menu">
            <button id="open-puzzle-dlg-btn">
                Puzzle
            </button>
            <button id="help-button">Help</button>
            <button id="about-button">About</button>
        </span>
    </header>
    <main id="main-content">
    </main>
    <script src="https://csingendonk.github.io/htmlpanels/sliderPuzzle/js/loadExternalScripts.js"></script>
    <script id="ui-interaction-inititializer-script">
    // Get references to the buttons
    const helpButton = document.getElementById('help-button');
    const aboutButton = document.getElementById('about-button');
    const openPuzzleDlgBtn = document.getElementById('open-puzzle-dlg-btn');
    
    // Add event listeners to the buttons
    openPuzzleDlgBtn.addEventListener('click', (event) => {
        Array.from(document.body['popups']).forEach(p => {
            if (p.title === 'Puzzle') {
                p.show();
                return;
            }
        })
        const ce = document.createElement('slider-puzzle');
        const pu = new PopupBox('Puzzle', [ce], 'option');
        document.body['popups'].push(pu);
        pu.show();
    })
    
    document.body['popups'] = [];
    
    // Help button event listener
helpButton.addEventListener('click', () => {
    let existingPopup = document.body.popups.find(p => p.title === 'Help');

    if (existingPopup) {
        // If the popup already exists, just show it
        existingPopup.show();
    } else {
        // Create a new div element to hold the markdown content
        const contentElement = document.createElement('div');
        contentElement.id = 'help-content'; // Optional ID for styling

        // Load and render the Markdown content
        renderMarkdown('https://csingendonk.github.io/htmlpanels/sliderPuzzle/misc/help.md', contentElement)
            .then(() => {
                // Create and display the popup after content is loaded
                const newPopup = new PopupBox('Help', [contentElement], 'option');
                document.body.popups.push(newPopup);
                newPopup.show();
            })
            .catch(error => {
                console.error('Error loading the Markdown file:', error);
                alert('Failed to load the About content.');
            });
    }
});

    // About button event listener
   // Initialize the popups array if not already done
document.body.popups = document.body.popups || [];

aboutButton.addEventListener('click', () => {
    let existingPopup = document.body.popups.find(p => p.title === 'About');

    if (existingPopup) {
        // If the popup already exists, just show it
        existingPopup.show();
    } else {
        // Create a new div element to hold the markdown content
        const contentElement = document.createElement('div');
        contentElement.id = 'about-content'; // Optional ID for styling

        // Load and render the Markdown content
        renderMarkdown('https://csingendonk.github.io/htmlpanels/sliderPuzzle/misc/about.md', contentElement)
            .then(() => {
                // Create and display the popup after content is loaded
                const newPopup = new PopupBox('About', [contentElement], 'option');
                document.body.popups.push(newPopup);
                newPopup.show();
            })
            .catch(error => {
                console.error('Error loading the Markdown file:', error);
                alert('Failed to load the About content.');
            });
    }
});

// Function to fetch and render Markdown content
function renderMarkdown(fileUrl, targetElement) {
    return fetch(fileUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Failed to fetch Markdown file: ${response.statusText}`);
            }
            return response.text();
        })
        .then(markdownText => {
            if (typeof marked === 'undefined') {
                throw new Error('Marked.js library is not loaded.');
            }
            // Convert Markdown to HTML
            const htmlContent = marked.parse(markdownText);
            // Set the HTML content to the target element
            targetElement.innerHTML = htmlContent;
        });
}

</script>

</body>

</html>
