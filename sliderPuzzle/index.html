<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Slider Puzzle</title>
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <header id="header" class="header-main bar" role="banner">
        <span class="header-main-title">
            <h1>Slider Puzzle</h1>
        </span>
        <span class="header-main-menu">
            <button id="open-puzzle-dlg-btn">
                Puzzle
            </button>
            <button id="help-button">Help</button>
            <button id="about-button">About</button>
        </span>
    </header>
    <main id="main-content">
    </main>
    <script src="./js/loadExternalScripts.js"></script>
    <script id="ui-interaction-inititializer-script">
    // Get references to the buttons
    const helpButton = document.getElementById('help-button');
    const aboutButton = document.getElementById('about-button');
    const openPuzzleDlgBtn = document.getElementById('open-puzzle-dlg-btn');
    
    // Add event listeners to the buttons
    openPuzzleDlgBtn.addEventListener('click', (event) => {
        Array.from(document.body['popups']).forEach(p => {
            if (p.title === 'Puzzle') {
                p.show();
                return;
            }
        })
        const ce = document.createElement('slider-puzzle');
        const pu = new PopupBox('Puzzle', [ce], 'option');
        document.body['popups'].push(pu);
        pu.show();
    })
    
    document.body['popups'] = [];
    
    // Help button event listener
    helpButton.addEventListener('click', () => {
        Array.from(document.body['popups']).forEach(p => {
            if (p.title === 'Help') {
                p.show();
                return;
            }
        })
        const ce = document.createElement('div');
        ce.innerHTML = `
                        <style>
                            p {
                                font-size: 0.9rem; 
                            }

                            b {
                                color: #0000009f;
                                background-color: #ffffffaa;
                                font-size: 1.1rem;
                            }
                        </style>    
                        
                        
                        <dl><dt><b>How to Play</b></dt>
                            <dd>
                            <p>
                            <b>Objective:</b>
                            <br>
                            The puzzle consists of a grid of numbered tiles. The goal is to rearrange the tiles to correctly display the image.
                            </p>
                            <p>
                            <b>Moving Tiles</b>
                            <br>
                            To move a tile it must be adjacent to the free space in the puzzle. The tile will slide into the empty space when you click or tap it.
                            </p>
                            <p>
                            <b>Resetting the Puzzle</b>
                            <br>
                            If you get stuck or want to start over, you can reset the puzzle by clicking the "Reset" button.
                            </p>
                            <p>
                            <b>Winning the Game</b>
                            <br>
                            The game is won when the puzzle is solved.
                            </p>
                            <p>
                            <b>Tips</b>
                            <br>
                            - Try to solve the puzzle in the fewest moves possible.
                            <br>
                            - Use the "Reset" button to start over if you get stuck.
                            <br>
                            - Use the "Help" button to get tips and hints.
                            </p>
                            </dd>
                            <dt><b>General</b></dt>
                            <dd>
                            <p>
                            <b>Reference</b>
                            <br>
                            To view the image as it should look, click the "HINT" button.
                            </p>
                            <p>
                            <b>Move and Resize</b>
                            <br>
                            To move the puzzle around, click and drag the puzzle.
                            <br>
                            To resize the puzzle, click and drag the bottom right corner.
                            </p>
                            <p>
                            <b>Keyboard Shortcuts</b>
                            <br>
                            - Press "R" to reset the puzzle.
                            <br>
                            - Press "H" to show the puzzle image when solved.
                            <br>
                            - Press "S" to randomly shuffle the puzzle tiles.
                            <br>
                            - Press "N" to start a new puzzle with a random image.
                            <br>
                            
                            - Use the arrow keys to move the empty space of the puzzle.
                            <br>
                            - Use the file upload button to upload your own image to use as the puzzle.
                            <br>
                        </p>
                        </dd>
                        </dl>`;
        ce.style.color = '#44aa119f';
        ce.style.fontSize = '1.2em';
        ce.style.fontFamily = 'Arial';

        let pu = new PopupBox('HELP', [ce], []);
        document.body['popups'].push(pu);
        pu.show();
    });

    // About button event listener
   // Initialize the popups array if not already done
document.body.popups = document.body.popups || [];

aboutButton.addEventListener('click', () => {
    let existingPopup = document.body.popups.find(p => p.title === 'About');

    if (existingPopup) {
        // If the popup already exists, just show it
        existingPopup.show();
    } else {
        // Create a new div element to hold the markdown content
        const contentElement = document.createElement('div');
        contentElement.id = 'about-content'; // Optional ID for styling

        // Load and render the Markdown content
        renderMarkdown('./misc/about.md', contentElement)
            .then(() => {
                // Create and display the popup after content is loaded
                const newPopup = new PopupBox('About', [contentElement], 'option');
                document.body.popups.push(newPopup);
                newPopup.show();
            })
            .catch(error => {
                console.error('Error loading the Markdown file:', error);
                alert('Failed to load the About content.');
            });
    }
});

// Function to fetch and render Markdown content
function renderMarkdown(fileUrl, targetElement) {
    return fetch(fileUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Failed to fetch Markdown file: ${response.statusText}`);
            }
            return response.text();
        })
        .then(markdownText => {
            if (typeof marked === 'undefined') {
                throw new Error('Marked.js library is not loaded.');
            }
            // Convert Markdown to HTML
            const htmlContent = marked.parse(markdownText);
            // Set the HTML content to the target element
            targetElement.innerHTML = htmlContent;
        });
}

</script>

</body>

</html>
