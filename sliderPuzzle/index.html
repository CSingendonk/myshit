<html>
  <head>
      <title>CS 2025</title>
      <link rel="stylesheet" href="https://csingendonk.github.io/htmlpanels/sliderPuzzle/css/style.css">
  </head>
  <body>
      <header id="header" class="header-main bar" role="banner">
          <span class="header-main-title">
              <CC:ie=<fuck>
                <fuck>fuck</fuck>
              </fuck>
              </Cc:noie>
          </span>
          <span class="header-main-menu">
              <button id="open-puzzle-dlg-btn">Puzzle</button>
              <button id="open-dice-btn">Dice</button>
              <button id="help-button">Help</button>
              <button id="about-button">About</button>
          </span>
      </header>
      <main id="main-content"></main>
      <script src="https://csingendonk.github.io/htmlpanels/sliderPuzzle/js/loadExternalScripts.js"></script>
      <script id="ui-interaction-inititializer-script">
      const helpButton = document.getElementById('help-button');
      const aboutButton = document.getElementById('about-button');
      const openPuzzleDlgBtn = document.getElementById('open-puzzle-dlg-btn');
      const openDiceBtn = document.getElementById('open-dice-btn');

      document.body.popups = [];

      openDiceBtn.addEventListener('click', () => {
          const iframe = document.createElement('iframe');
          iframe.src = 'https://csingendonk.github.io/htmlpanels/diceroller/index.html';
          iframe.style.width = '100vw';
          iframe.style.height = '100vh';
          iframe.style.border = '2px groove #3f0';
          iframe.style.position = 'absolute';
          iframe.style.display = 'block';
          iframe.style.overflow = 'hidden';
          iframe.style.flexShrink = '1';
          iframe.style.resize = 'both';
          iframe.style.top = '0';
          iframe.style.left = '0';
          iframe.style.transform = 'scale(0.75)';
          iframe.style.transformOrigin = 'top left';
        
          iframe.onload = function() {
              const doc = iframe.contentWindow.document;
              const scaleStyles = {
                  transform: 'scale(0.75)',
                  transformOrigin: 'top left',
                  width: '100%',
                  height: '100%'
              };
              Object.assign(doc.documentElement.style, scaleStyles);
              Object.assign(doc.body.style, scaleStyles);
          };

          const container = document.createElement('div');
          container.style.resize = 'both';
          container.style.position = 'absolute';
          container.style.display = 'flex';
          container.style.overflow = 'hidden';
          container.style.flexShrink = '1';
          container.style.top = '0';
          container.style.left = '0';
          container.style.width = '100%';
          container.style.height = '100%';

          const closeButton = document.createElement('button');
          closeButton.innerText = '❌';
          closeButton.style.zIndex = Number.MAX_SAFE_INTEGER;
          closeButton.style.backgroundColor = '#ff000099';
          closeButton.title = 'Close Dice Roller';
          closeButton.style.display = 'inline-flex';
          closeButton.style.position = 'absolute';
          closeButton.style.top = '0';
          closeButton.style.right = '25%';

          const dragGrip = document.createElement('drag-grip');

          container.appendChild(closeButton);
          container.appendChild(dragGrip);
          container.appendChild(iframe);
          document.body.appendChild(container);

          closeButton.addEventListener('click', () => {
              container.remove();
          });
      });

      openPuzzleDlgBtn.addEventListener('click', () => {
        const iframe = document.createElement('iframe');
          iframe.style.width = '98vw';
          iframe.style.height = '98vh';
          iframe.style.border = '2px groove #3f0';
          iframe.style.position = 'absolute';
          iframe.style.overflow = 'hidden';
          iframe.style.flexShrink = '1';
          iframe.style.resize = 'both';
          iframe.style.top = '50%';
          iframe.style.left = '50%';
          iframe.style.transform = 'translate(-50%, -50%)';
          iframe.style.display = 'block';
          iframe.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
          iframe.style.borderRadius = '8px';
          
          const puzzleElement = document.createElement('slider-puzzle') || document.getElementsByTagName('slider-puzzle')[0];
          puzzleElement.style.width = '100%';
          puzzleElement.style.height = '100%';
          puzzleElement.style.border = 'none';
          puzzleElement.style.position = 'relative';
          puzzleElement.style.display = 'block';
          puzzleElement.style.overflow = 'hidden';
          puzzleElement.style.flexShrink = '1';
          puzzleElement.style.resize = 'both';
          puzzleElement.style.margin = 'auto';
          puzzleElement.style.backgroundColor = '#f5f5f5';
          puzzleElement.style.padding = '20px';
          puzzleElement.style.borderRadius = '8px';
          puzzleElement.style.boxShadow = 'inset 0 2px 4px rgba(0,0,0,0.1)';

          const container = document.createElement('div');
          container.style.resize = 'both';
          container.style.position = 'absolute';
          container.style.display = 'flex';
          container.style.flexShrink = '1';
          container.style.top = '50%';
          container.style.left = '50%';
          container.style.transform = 'translate(-50%, -50%)';
          container.style.width = '90%';
          container.style.height = '90%';
          container.style.maxWidth = '800px';
          container.style.maxHeight = '600px';
          container.style.backgroundColor = 'white';
          container.style.borderRadius = '12px';
          container.style.boxShadow = '0 8px 16px rgba(0,0,0,0.15)';

          const closeButton = document.createElement('button');
          closeButton.innerText = '❌';
          closeButton.style.zIndex = Number.MAX_SAFE_INTEGER;
          closeButton.style.backgroundColor = '#ff000099';
          closeButton.title = 'Close Slider Puzzle';
          closeButton.style.display = 'inline-flex';
          closeButton.style.position = 'absolute';
          closeButton.style.top = '10px';
          closeButton.style.right = '10px';
          closeButton.style.border = 'none';
          closeButton.style.borderRadius = '50%';
          closeButton.style.padding = '8px';
          closeButton.style.cursor = 'pointer';
          closeButton.style.transition = 'all 0.2s ease';

          const dragGrip = document.createElement('drag-grip');
          dragGrip.style.cursor = 'move';

          document.scripts.forEach(s => {
            const s2 = document.createElement('script');
            s2.src = s.src;
            container.appendChild(s2);
          })
          container.appendChild(closeButton);
          container.appendChild(dragGrip);
          container.appendChild(puzzleElement);
          iframe.srcdoc = container.innerHTML;
          closeButton.addEventListener('click', () => {
              iframe.remove();
          });
          document.body.appendChild(iframe);
      });
      openPuzzleDlgBtn.addEventListener('click', () => {
          const existingPuzzle = Array.from(document.body.popups).find(p => p.title === 'Puzzle');
          if (existingPuzzle) {
              existingPuzzle.show();
              return false;
          }
          const puzzleElement = document.createElement('slider-puzzle');
          const popup = new PopupBox('SP', [puzzleElement], []);
          popup.show();
      });

      function createPopup(title, contentId) {
          const existingPopup = document.body.popups.find(p => p.title === title);
          if (existingPopup) {
              existingPopup.show();
              return;
          }

          const contentElement = document.createElement('div');
          contentElement.id = contentId;

          renderMarkdown(`https://csingendonk.github.io/htmlpanels/sliderPuzzle/misc/${title.toLowerCase()}.md`, contentElement)
              .then(() => {
                  const popup = new PopupBox(title, [contentElement], 'option');
                  document.body.popups.push(popup);
                  popup.show();
              })
              .catch(error => {
                  console.error(`Error loading the ${title} file:`, error);
                  alert(`Failed to load the ${title} content.`);
              });
      }

      helpButton.addEventListener('click', () => createPopup('Help', 'help-content'));
      aboutButton.addEventListener('click', () => createPopup('About', 'about-content'));

      function renderMarkdown(fileUrl, targetElement) {
          return fetch(fileUrl)
              .then(response => {
                  if (!response.ok) {
                      throw new Error(`Failed to fetch Markdown file: ${response.statusText}`);
                  }
                  return response.text();
              })
              .then(markdownText => {
                  if (typeof marked === 'undefined') {
                      throw new Error('Marked.js library is not loaded.');
                  }
                  targetElement.innerHTML = marked.parse(markdownText);
              });
      }
      </script>
  </body>
  </html>
